import React, { useEffect, useState } from 'react';
import * as Tone from 'tone';

const SatelliteTheme = () => {
  const [isPlaying, setIsPlaying] = useState(false);

  useEffect(() => {
    // –°–æ–∑–¥–∞–µ–º –±–æ–ª–µ–µ –≥–µ—Ä–æ–∏—á–µ—Å–∫–∏–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä
    const heroSynth = new Tone.PolySynth({
      oscillator: {
        type: 'sawtooth' // –ë–æ–ª–µ–µ –æ—Å—Ç—Ä—ã–π, –≥–µ—Ä–æ–∏—á–µ—Å–∫–∏–π –∑–≤—É–∫
      },
      envelope: {
        attack: 0.1,
        decay: 0.2,
        sustain: 0.5,
        release: 0.8
      }
    }).toDestination();

    // –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –±–æ–ª–µ–µ —ç–ø–∏—á–µ—Å–∫–æ–≥–æ –∑–≤—É—á–∞–Ω–∏—è
    const chorus = new Tone.Chorus(4, 2.5, 0.5).toDestination();
    const reverb = new Tone.Reverb(3).toDestination();
    const distortion = new Tone.Distortion(0.3).toDestination();

    // –ì–µ—Ä–æ–∏—á–µ—Å–∫–∞—è –º–µ–ª–æ–¥–∏—á–µ—Å–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    const heroMelody = new Tone.Sequence((time, note) => {
      heroSynth.triggerAttackRelease(note, '4n', time);
    }, [
      ['C5', 'E5', 'G5'], 
      ['D5', 'F5', 'A5'], 
      ['E5', 'G5', 'B5'],
      ['F5', 'A5', 'C6']
    ], '2n');

    // –¢–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∞—Ä–∞–±–∞–Ω–Ω—ã–π —Ä–∏—Ç–º
    const heroPercussion = new Tone.MembraneSynth({
      pitchDecay: 0.05,
      octaves: 10,
      envelope: {
        attack: 0.001,
        decay: 0.4,
        sustain: 0.1,
        release: 1.4,
      }
    }).toDestination();

    const percussionPattern = new Tone.Sequence((time, pitch) => {
      if (pitch) {
        heroPercussion.triggerAttackRelease(pitch, '16n', time);
      }
    }, [
      'C2', null, 'G2', 'C3', 
      null, 'D2', null, 'A2'
    ], '4n');

    // –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω–æ–≤—ã–π —à—É–º
    const spaceNoise = new Tone.Noise('white').toDestination();
    spaceNoise.volume.value = -40; // –û—á–µ–Ω—å —Ç–∏—Ö–∏–π —Ñ–æ–Ω

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏
    const startMusic = async () => {
      await Tone.start();
      Tone.Transport.bpm.value = 100; // –ë–æ–ª–µ–µ –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —Ç–µ–º–ø
      Tone.Transport.start();
      heroMelody.start();
      percussionPattern.start();
      spaceNoise.start();
      setIsPlaying(true);
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º—É–∑—ã–∫–∏
    const stopMusic = () => {
      Tone.Transport.stop();
      heroMelody.stop();
      percussionPattern.stop();
      spaceNoise.stop();
      setIsPlaying(false);
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    window.startSatelliteMusic = startMusic;
    window.stopSatelliteMusic = stopMusic;

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      heroMelody.dispose();
      percussionPattern.dispose();
      heroSynth.dispose();
      spaceNoise.dispose();
    };
  }, []);

  return (
    <div className="bg-black text-white p-4 flex flex-col items-center">
      <h2 className="text-xl mb-4">Satellite: –ì–µ—Ä–æ–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π</h2>
      <p className="mb-4 text-center text-sm">
        –ú—É–∑—ã–∫–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥—É—Ö –ø–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥—Ü–µ–≤, —É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω—ã—Ö –≤ –Ω–µ–∏–∑–≤–µ–¥–∞–Ω–Ω–æ–µ
      </p>
      <div className="flex space-x-4">
        <button 
          onClick={() => window.startSatelliteMusic()}
          className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300 transform hover:scale-105"
        >
          üöÄ –ù–∞—á–∞—Ç—å –º–∏—Å—Å–∏—é
        </button>
        <button 
          onClick={() => window.stopSatelliteMusic()}
          className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-300 transform hover:scale-105"
        >
          ‚èπÔ∏è –ü—Ä–µ—Ä–≤–∞—Ç—å
        </button>
      </div>
    </div>
  );
};

export default SatelliteTheme;